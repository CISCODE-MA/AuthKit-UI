trigger:
  branches:
    include:
      - main

pool:
  vmImage: ubuntu-latest

variables:
  - group: FE-WEB

steps:
  - checkout: self
    fetchDepth: 0
    persistCredentials: true

  - script: |
      set -euo pipefail

      echo "Preparing Git identity..."
      git config user.name "azure-devops-mirror"
      git config user.email "azure-devops-mirror@ciscod.com"

      echo "Adding/updating GitHub remote..."
      # Use PAT via https. Azure will mask secret variables in logs.
      git remote remove github 2>/dev/null || true
      git remote add github "https://$(GITHUB_MIRROR_PAT)@github.com/CISCODE-MA/AuthKit-UI.git"

      echo "Force mirroring ALL refs (branches + tags) to GitHub..."
      git push --mirror github
    displayName: "Mirror Azure repo to GitHub (force --mirror)"